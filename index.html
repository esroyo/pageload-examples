<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pageload examples</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Learn how a web page loads by example">
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
  <link rel="stylesheet" href="./assets/new.css">
</head>
<body>
  <header>
    <h1>🌍&nbsp; Page loading</h1>
  </header>

  <details id="toc" open>
    <summary>Table of contents</summary>
    <ul>
      <li><a href="#basic-html">Loading a web site is a gradual process</a></li>
      <li><a href="#basic-html-style">External styles block rendering, but not document parsing</a></li>
      <li><a href="#basic-html-style-inline">Fast styled rendering, with inline styles</a></li>
      <li><a href="#basic-html-style-critical">Sweet spot: inline critical styles</a></li>
      <li><a href="#basic-html-script">Scripts block document parsing, but not rendering</a></li>
      <li><a href="#basic-html-style-script">Scripts execution requires to finish any ongoing styles loading</a></li>
      <li><a href="#basic-html-style-script-defer">Deferred scripts don't block document parsing</a></li>
      <li><a href="#basic-html-style-script-async">Async scripts block (almost) nothing</a></li>
    </ul>
  </details>  

  <hr>

  <article id="basic-html">
    <h2>📝 Loading a web site is a gradual process</h2>

    <figure>
      <blockquote>
        It's important to understand that [...] is a gradual process. For better user experience, the rendering engine will try to display contents on the screen as soon as possible. It will not wait until all HTML is parsed before starting to build and layout the render tree. Parts of the content will be parsed and displayed, while the process continues with the rest of the contents that keeps coming from the network.
      </blockquote>
      <figcaption>
        &mdash; Tali Garsiel, <cite>How browsers work</cite>
      </figcaption>
    </figure>

    <p>Let's demonstrate that fact by loading a page with lots of text content. Page download is throttled by the server and takes a long time.</p>
    <p>Try to scroll down while the page is being downloaded.</p>
    <p>The display keeps updating, but <code>DOMContentLoaded</code> event won't trigger until the download and parsing of the HTML is <em>completed</em>.</p>
    <p>There is no <em>direct</em> correlation between the delay on those events and a poor core web vitals score. Although the page is loading, LCP will happen soon enough. This doesn't mean the "performance" of the page is good.</p>

    <p>
    <a href="https://proxy-throttle.deno.dev/?factor=5&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html%2F" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;html throttle="5"&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;!-- Long HTML contents --&gt;

  &lt;/body&gt;
&lt;/html&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
     136.60 ├ requestStart
     373.20 ├ responseStart
            ┊
    3213.90 ├ paint: first-paint
    3213.90 ├ paint: first-contentful-paint
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   30480.60 ├ responseEnd
   30482.00 ├ domInteractive
   30482.00 ├ domContentLoadedEventStart
   30482.00 ├ domContentLoadedEventEnd
   30482.40 ├ domComplete
   30482.50 ├ loadEventStart
   30482.50 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows the first paint happening much earlier than the HTML's response end.
        </figcaption>
      </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style">
    <h2>📝 External styles block rendering, but not document parsing</h2>
    <p>As we have seen in the previous example, the DOM content tree is gradually builded as the HTML is downloaded. What if we have an stylesheet link on that page?</p>

    <p>An external stylesheet by itself does not block <em>all</em> of the process. The fetching of the stylesheet starts, but the HTML parsing continues. The <code>DOMContentLoaded</code> event will trigger regardless the style state.</p>

    <p><em>However</em>, although the <code>DOMContentLoaded</code> event fires, <strong>the page won't be displayed to the user</strong> until the fetching of the style is done.</p>

    <p>This means an stylesheet resource doesn't block the document parsing, but will block the rendering. From JavaScript land It feels strange to have no visual feedback when <code>DOMContentLoaded</code> has already fired. There seems to be no way to force the browser into the first paint.</p>

    <p>If an style is added dynamically from JavaScript, It won't block the rendering. Even if that is done <em>before</em> the first render.</p>

    <p>While there are pending styles to download and parse, the window `load` will not fire. No matter how late they have been added to the DOM.</p>

    <p>
    <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-style/" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;link rel="stylesheet" href="./assets/new.css" throttle="10"&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Long HTML contents --&gt;

&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      83.90 ├ requestStart
     272.10 ├ responseStart
     274.30 ├ responseEnd
     280.10 ├ resourceStart: link("…mples/assets/new.css")
     287.80 ├ domInteractive
     287.80 ├ domContentLoadedEventStart
     287.80 ├ domContentLoadedEventEnd
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   10559.70 ├ resourceEnd: link("…mples/assets/new.css")
   10692.60 ├ domComplete
   10692.60 ├ loadEventStart
   10692.60 ├ loadEventEnd
   10833.80 ├ paint: first-paint
   10833.80 └ paint: first-contentful-paint</pre>
        <figcaption>
          Timeline: It shows that an external style link does not block the document parsing nor the <code>DOMContentLoaded</code> event. However the first paint won't happen until the download and processing of the style resource ends. 
        </figcaption>
    </figure>

    </details>

    <details>
      <summary>Quirks</summary>
      <ul>
        <li><mark>Blink</mark>; When the <code>link</code> tag is located in the <code>head</code>, then as claimed the document parsing is not blocked. However if the <code>link</code> tag is located in the <code>body</code>, <strong>It blocks the document parsing</strong> (the hard way). Test it in <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-style-body/" target="_blank">this secondary example</a>. Gecko and WebKit based browsers don't observe this difference between <code>body</code> and <code>head</code>.</li>
      </ul>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style-inline">
    <h2>📝 Fast styled rendering, with inline styles</h2>

    <p>We can achieve the gradual rendering effect seen on the <a href="#basic-html">first example</a> while displaying already styled content. It is possible by inlining the contents of the stylesheet.</p>

    <p>Although inlining styles is a limited option (prevents caching, is difficult to scale),
    for the shake of the example It is cool to see how the browser can build the DOM and render styled contents as the HTML is dowloaded.</p>

    <p>
    <a href="https://proxy-throttle.deno.dev/?factor=5&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html-style-inline%2F" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;style&gt;
    /* Inlined CSS */
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Long HTML contents --&gt;

&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      13.20 ├ requestStart
     245.40 ├ responseStart
            ┊
    3264.70 ├ paint: first-paint
    3264.70 ├ paint: first-contentful-paint
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   35206.40 ├ responseEnd
   35207.00 ├ domInteractive
   35207.00 ├ domContentLoadedEventStart
   35207.00 ├ domContentLoadedEventEnd
   35207.20 ├ domComplete
   35207.30 ├ loadEventStart
   35207.30 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows an early painting, given there are no external resources.
        </figcaption>
      </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style-critical">
    <h2>📝 Sweet spot: inline critical styles</h2>

    <p>The best experience comes when only <a href="https://css-tricks.com/authoring-critical-fold-css/" target="_blank">critical styles</a> are inlined, as we get the gradual rendering effect of styled content.</p>

    <p>However It forces the loading of the non-critical styles on a deferred stage. The <code>media</code> attribute <a href="https://github.com/filamentgroup/loadCSS" target="_blank">trick</a> is a well known option for the deferred load. Although It feels hackish and relies on JavaScript.</p>

    <p>Another possiblity would be to put the non-critical styles in a <code>link rel="preload"</code> tag. That <code>link</code> wouldn't block document parsing nor rendering. Finally place the regular <code>link</code> to the same style at the very end of the <code>body</code>. Rendering can't be blocked if something has been already painted.</p>

    <p>This would be a sweet spot solution, except for the quirk commented on the <a href="#basic-html-style">external styles example</a>. Blink blocks the document parsing when it finds a style <code>link</code> in the <code>body</code>. Thus although the visual exeperience is good, the delay of <code>DOMContentLoaded</code> makes this solution non-generalizable.</p>

    <p><a href="https://proxy-throttle.deno.dev/?factor=2&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html-style-critical-blink%2F" target="_blank">This secondary example</a> shows the alternative for Blink (using the <code>onload</code> attribute).</p>

    <p>
    <a href="https://proxy-throttle.deno.dev/?factor=2&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html-style-critical%2F" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;link rel="preload" as="style" href="./assets/new.css" throttle="15"&gt;
  &lt;style&gt;
    /* Limited critical CSS */
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Long HTML contents --&gt;

  &lt;link rel="stylesheet" href="./assets/new.css" throttle="15"&gt;
&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      84.00 ├ requestStart
            ┊
            ┊
    3226.00 ├ responseStart
    3275.00 ├ resourceStart: link("…mples/assets/new.css")
    3313.00 ├ paint: first-contentful-paint
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   12443.00 ├ responseEnd
   12445.00 ├ domInteractive
   12445.00 ├ domContentLoadedEventStart
   12445.00 ├ domContentLoadedEventEnd
            ┊
            ┊
            ┊
            ┊
   18586.00 ├ resourceEnd: link("…mples/assets/new.css")
   18779.00 ├ domComplete
   18779.00 ├ loadEventStart
   18779.00 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows an early paint. Contents are displayed as they arrive, styled with the critical inlined styles. Meanwhile non-critical styles are being preloaded and won't block anything. Once the non-critical styles are downloaded the styles are applied (reflow). This sequence of events is taken from a WebKit based browser.
        </figcaption>
    </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-script">
    <h2>📝 Scripts block document parsing, but not rendering</h2>
    <p>When an script is found in the HTML, the browser pauses the document parsing until the script is executed.</p>

    <p>If the script is external, It must be fetched and then executed. Document parsing won't continue until the script ends execution.</p>

    <p>Givent that an script does not necessarily block the rendering, the location of the script in the document is important. If the script is located at the end of the body, some rendering is possible</p>.

    <p>
    <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-script/" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Long HTML contents --&gt;

  &lt;script src="./assets/junk.js" throttle="10"&gt;&lt;/script&gt;
&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      12.90 ├ requestStart
      14.20 ├ responseStart
      16.50 ├ responseEnd
      20.20 ├ resourceStart: script("…mples/assets/junk.js")
      62.10 ├ paint: first-paint
      62.10 ├ paint: first-contentful-paint
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   10395.70 ├ resourceEnd: script("…mples/assets/junk.js")
   10397.10 ├ mark: script execution
   10402.50 ├ domInteractive
   10402.60 ├ domContentLoadedEventStart
   10402.60 ├ domContentLoadedEventEnd
   10420.10 ├ domComplete
   10420.20 ├ loadEventStart
   10420.20 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows that an external script blocks document parsing. Interactive state won't be reached until the script is fetched and executed. However if enough document content has been already parsed, paint still happens.
        </figcaption>
    </figure>

    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style-script">
    <h2>📝 Scripts execution requires to finish the ongoing styles loading</h2>

    <p>As we have seen <a href="#basic-html-style">previously</a>, and external stylesheet will not block the document parsing. However if the external style is followed by an script, things change.</p>
   
    <p>An script not only pauses the document parsing, but also requires to finish the <em>ongoing</em> styles loading. Only then will start its execution.</p>

    <p>So document parsing becomes blocked when it gets to an script. In turn the script execution is blocked by the loading styles.</p>

    <p>Note we emphasize the fact that only <em>ongoing</em> loading styles will block the script. If the order is inverted and the script is placed before the style, It will get executed immediately. See that in <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-script-style/" target="_blank">this secondary example</a> (timeline will be similar to the <a href="#basic-html-style">second case</a>).</p>

    <p><strong>This rule only applies to <em>initial</em> styles</strong>. That is to stylesheet links that are in the initial HTML response. Stylesheet links added dynamically do not block successive scripts, even if they are added to the document before those scripts.</p>

    <p>
    <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-style-script/" target="_blank"><button>Open example</button></a>
    </p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;link rel="stylesheet" href="./assets/new.css" throttle="10"&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Long HTML contents --&gt;

  &lt;script&gt;
    performance.mark('script execution');
  &lt;/script&gt;
&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      13.50 ├ requestStart
      14.50 ├ responseStart
      17.10 ├ responseEnd
      21.50 ├ resourceStart: link("…mples/assets/new.css")
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   10664.50 ├ resourceEnd: link("…mples/assets/new.css")
   10790.70 ├ mark: script execution
   10826.20 ├ domInteractive
   10826.20 ├ domContentLoadedEventStart
   10826.20 ├ domContentLoadedEventEnd
   10842.20 ├ paint: first-paint
   10842.20 ├ paint: first-contentful-paint
   11041.90 ├ domComplete
   11041.90 ├ loadEventStart
   11042.00 └ loadEventEnd</pre>
        <figcaption>
          Timeline: The external style by itself would not block the document parsing, as seen <a href="#basic-html-style">previously</a>. However the script gets blocked by the style loading, and in turn the script blocks the document parsing. Thus DOM interactive is bounded by the style loading plus the script execution.
        </figcaption>
    </figure>

    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style-script-defer">
    <h2>📝 Deferred scripts don't block document parsing</h2>

    <p>Even though deferred scripts don't block document parsing and get downloaded in parallel (with low priority), they share some key behaviours with the "normal" synchronous script tags:
      <ul>
        <li>They are executed in the order they were added to the DOM tree.</li>
        <li>They are executed before <code>DOMContentLoaded</code> event.</li>
        <li>They don't block rendering. (see <a href="https://esroyo.github.io/pageload-examples/examples/basic-html-script-defer/" target="_blank">secondary example</a>)</li>
        <li>Before execution they must wait for ongoing styles loading (if any) to end.</li>
      </ul>
    </p>

    <p>They are all executed at the same time, before <code>DOMContentLoaded</code>. Therefore all deferred scripts need to be completely downloaded before any of them can execute.</p>

    <p>Roughtly we can think of deferred scripts as synchronous scripts whose execution is pushed towards the end of the document parsing process, with the benefit of prefetching them.</p>

    <p><a href="https://esroyo.github.io/pageload-examples/examples/basic-html-style-script-defer/" target="_blank"><button>Open example</button></a></p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;link rel="stylesheet" href="./assets/new.css" throttle="10"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script src="./assets/junk.js#def1" defer throttle="5"&gt;&lt;/script&gt;
  &lt;script src="./assets/junk.js#def2" defer throttle="2"&gt;&lt;/script&gt;

  &lt;!-- Long HTML contents --&gt;

&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      14.40 ├ requestStart
            ┊
     380.50 ├ responseStart
     383.60 ├ responseEnd
     389.50 ├ resourceStart: link("…mples/assets/new.css")
     389.90 ├ resourceStart: script("…mples/assets/junk.js#def1")
     390.10 ├ resourceStart: script("…mples/assets/junk.js#def2")
     399.80 ├ domInteractive
            ┊
            ┊
            ┊
            ┊
            ┊
    2839.10 ├ resourceEnd: script("…mples/assets/junk.js#def2")
            ┊
            ┊
            ┊
            ┊
            ┊
    5578.00 ├ resourceEnd: script("…mples/assets/junk.js#def1")
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   10518.10 ├ resourceEnd: link("…mples/assets/new.css")
   10566.40 ├ mark: script execution -- deferred 1
   10566.70 ├ mark: script execution -- deferred 2
   10566.80 ├ domContentLoadedEventStart
   10566.80 ├ domContentLoadedEventEnd
   10624.40 ├ paint: first-paint
   10624.40 ├ paint: first-contentful-paint
   10642.40 ├ domComplete
   10642.50 ├ loadEventStart
   10642.50 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows two deferred scripts that start to download as the document parses. The document parsing ends and It reaches the <em>interactive</em> state. The first deferred script takes 5s to download and the second takes 2s. They need to wait for the style download to end. Then both get executed in order. Finally <code>DOMContentLoaded</code> is fired. The rendering is hold by the style download, not the scripts. Without the external style, rendering would take place almost immediately.
        </figcaption>
    </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-style-script-async">
    <h2>📝 Async scripts block (almost) nothing</h2>

    <p>Async scripts are like "free agents". They:
      <ul>
        <li>Do not block document parsing.</li>
        <li>Do not block rendering.</li>
        <li>Do not require the ongoing styles loading to end.</li>
        <li>Do not require pending scripts to execute.</li>
        <li>Will execute as soon as possible, once they are downloaded.</li>
        <li>Because of that, they may delay ongoing critical processes! (for instance, they could execute while document parsing has not finished).</li>
        <li>Finally, they do block the window <code>load</code> event.</li>
      </ul>
    </p>

    <p><a href="https://proxy-throttle.deno.dev/?factor=0.2&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html-style-script-async%2F" target="_blank"><button>Open example</button></a></p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;link rel="stylesheet" href="./assets/new.css" throttle="1"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script async src="./assets/junk.js#async1" throttle="5"&gt;&lt;/script&gt;
  &lt;script async src="./assets/fib.js#async2" throttle="0" data-fibonacci-number="42"&gt;&lt;/script&gt;
  &lt;script async src="./assets/junk.js#async3" throttle="1"&gt;&lt;/script&gt;

  &lt;!-- Long HTML contents --&gt;

&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      18.40 ├ requestStart
            ┊
     363.10 ├ responseStart
     454.70 ├ resourceStart: link("…mples/assets/new.css")
     455.30 ├ resourceStart: script("…ssets/junk.js#async1")
     455.70 ├ resourceStart: script("…assets/fib.js#async2")
     455.80 ├ resourceStart: script("…ssets/junk.js#async3")
            ┊
     647.30 ├ resourceEnd: script("…assets/fib.js#async2")
     649.30 ├ mark: script execution -- async 2
     649.40 ├ mark: start fib(42)
            ┊
            ┊
            ┊
            ┊
    1592.20 ├ resourceEnd: link("…mples/assets/new.css")
    1592.60 ├ responseEnd
    1629.00 ├ resourceEnd: script("…ssets/junk.js#async3")
            ┊
            ┊
            ┊
            ┊
            ┊
    2834.70 ├ mark: end fib(42)
    2842.30 ├ domInteractive
    2842.30 ├ domContentLoadedEventStart
    2842.30 ├ domContentLoadedEventEnd
    2851.60 ├ mark: script execution -- async 3
    2926.30 ├ paint: first-paint
    2926.30 ├ paint: first-contentful-paint
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
    5893.70 ├ resourceEnd: script("…ssets/junk.js#async1")
    5894.80 ├ mark: script execution -- async 1
    5894.90 ├ domComplete
    5894.90 ├ loadEventStart
    5894.90 └ loadEventEnd</pre>
        <figcaption>
          Timeline: It shows that four external resources start loading (one style, three async scripts) while the document is being received and parsed. The 2nd async script is the first to end its download. At this point none of the other external resources, nor the document itself have been completely received yet. Execution of this 2nd async script starts and takes a while &mdash; around 2seconds, a very looong task! While this script is executing, three other resources have finished arriving (the style, the document itself, and the 3rd async script). They can't be processed while the 2nd script is executing. When the execution of the 2nd script ends, we are unblocked to continue processing stuff. The style is processed. The rest of the document is parsed and reaches the interactive state. And the 3rd async script gets executed. Finally some rendering happens. Much later, the 1st async script ends its download and executes. Only then the <code>load</code> event fires.
        </figcaption>
    </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

  <hr>

  <article id="basic-html-script-dynamic">
    <h2>📝 Dynamic scripts</h2>

    <p>We consider dynamic scripts those that are created using JavaScript (and added to the DOM). This can be done at any time, there is no restriction.</p>

    <p>There are two types of dynamic scripts: async (the default), or sync. There is no way to create a dynamic script that mimics the <code>defer</code> behaviour (makes no sense really).</p>

    <p>They don't block document parsing, even if they are sync and are added before the document is <em>interactive</em>.</p>

    <p>Dynamic sync scripts block each other. They execute in the order they were added to document (the insertion position is irrelevant).</p>

    <p>Dynamic async scripts behave exactly as non-dynamic async scripts: they almost block nothing, and get executed as soon as they are ready.</p>

    <p>In fact any dynamic script may execute in the middle of critical processes like document parsing. It is important to keep your eyes open.</p>

    <p>Finally, they do block the window <code>load</code> event. This is true for <em>every</em> dynamic script (async or sync), disregarding <strong>when they are added to the document</strong>. If they are added before <code>load</code> has fired, the event will be holded until the pending scripts execute.<p>

    <p><a href="https://proxy-throttle.deno.dev/?factor=0.4&url=https%3A%2F%2Fesroyo.github.io%2Fpageload-examples%2Fexamples%2Fbasic-html-script-dynamic%2F" target="_blank"><button>Open example</button></a></p>

    <details>
      <summary>HTML outline</summary>
      <pre>
&lt;head&gt;
  &lt;script async src="./assets/junk.js?async1" throttle="0"&gt;</script>
&lt;/head&gt;
&lt;body&gt;
  &lt;script async src="./assets/junk.js?async2" throttle="9"&gt;</script>
  &lt;script&gt;
    // mark: script execution -- inline 1
    // Adds a dynamic script async "?dyn-async1" throttle=5
  &lt;/script&gt;
  &lt;script&gt;
    // mark: script execution -- inline 2
    // Adds a dynamic script async "?dyn-async2" throttle=11
    // onload of "?dyn-async2":
    //   Adds a dynamic script async "?dyn-async3" throttle=3
  &lt;/script&gt;
  &lt;script defer src="./assets/junk.js?def1" throttle="6"&gt;</script>
  &lt;script&gt;
    // mark: script execution -- inline 3
    // Adds a dynamic script sync "?dyn-sync1" throttle=7
  &lt;/script&gt;
  &lt;script defer src="./assets/junk.js?def2" throttle="4"&gt;</script>

  &lt;!-- Long HTML contents --&gt;

  &lt;script&gt;
    // mark: script execution -- inline 4
    // Adds a dynamic script sync "?dyn-sync2" throttle=2
  &lt;/script&gt;
&lt;/body&gt;</pre>
    </details>

    <details>
      <summary>Timeline</summary>
      <figure>
        <pre>
       0.00 ┬ startTime
      51.60 ├ requestStart
            ┊
     311.70 ├ responseStart
     452.80 ├ resourceStart: script("…ssets/junk.js?async1")
     453.40 ├ resourceStart: script("…ssets/junk.js?async2")
     453.90 ├ resourceStart: script("…/assets/junk.js?def1")
     454.00 ├ resourceStart: script("…/assets/junk.js?def2")
     456.50 ├ mark: script execution -- inline 1
     457.50 ├ resourceStart: script("…/junk.js?dyn-async-1")
     458.00 ├ mark: script execution -- inline 2
     458.10 ├ resourceStart: script("…/junk.js?dyn-async-2")
     458.60 ├ mark: script execution -- inline 3
     458.70 ├ resourceStart: script("…s/junk.js?dyn-sync-1")
     499.90 ├ paint: first-paint
     499.90 ├ paint: first-contentful-paint
     632.80 ├ resourceEnd: script("…ssets/junk.js?async1")
     634.30 ├ mark: script execution -- async 1
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
    2859.50 ├ mark: script execution -- inline 4
    2859.90 ├ resourceStart: script("…s/junk.js?dyn-sync-2")
            ┊
    3055.20 ├ responseEnd
    3056.20 ├ domInteractive
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
    4919.20 ├ resourceEnd: script("…/assets/junk.js?def2")
    4920.40 ├ resourceEnd: script("…s/junk.js?dyn-sync-2")
            ┊
            ┊
            ┊
    5841.00 ├ resourceEnd: script("…/junk.js?dyn-async-1")
    5843.10 ├ mark: script execution -- dynamic async 1
            ┊
            ┊
            ┊
    6763.00 ├ resourceEnd: script("…/assets/junk.js?def1")
    6764.70 ├ mark: script execution -- deferred 1
    6765.00 ├ mark: script execution -- deferred 2
    6765.00 ├ domContentLoadedEventStart
    6765.10 ├ domContentLoadedEventEnd
            ┊
            ┊
            ┊
    7685.40 ├ resourceEnd: script("…s/junk.js?dyn-sync-1")
    7687.20 ├ mark: script execution -- dynamic sync 1
    7687.50 ├ mark: script execution -- dynamic sync 2
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   10141.20 ├ resourceEnd: script("…ssets/junk.js?async2")
   10143.00 ├ mark: script execution -- async 2
            ┊
            ┊
            ┊
            ┊
            ┊
   11679.10 ├ resourceEnd: script("…/junk.js?dyn-async-2")
   11680.90 ├ mark: script execution -- dynamic async 2
   11681.60 ├ mark: callback execution -- onload dynamic async 2
   11682.30 ├ resourceStart: script("…/junk.js?dyn-async-3")
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
            ┊
   14720.70 ├ resourceEnd: script("…/junk.js?dyn-async-3")
   14722.40 ├ mark: script execution -- dynamic async 3
   14722.60 ├ domComplete
   14722.70 ├ loadEventStart
   14722.80 └ loadEventEnd</pre>
        <figcaption>
        </figcaption>
    </figure>
    </details>

    <p>[<a href="#toc">TOP</a>]</p>
  </article>

</body>
</html>

